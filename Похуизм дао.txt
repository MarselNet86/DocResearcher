@app.route('/auth', methods=['GET', 'POST'])
def auth():
    if request.method == 'POST':
        email = request.form.get('email')
        password = request.form.get('password')
        if email and password:
            user = Users.query.filter_by(email=email).first()
            if user and check_password_hash(user.password, password):
                login_user(user)

                next_page = request.args.get('next')
                if next_page:
                    return redirect(next_page)
                else:
                    return redirect(url_for('panel'))  # перенаправление на главную страницу, если next_page равен None
            else:
                flash('Неверный логин или пароль!')
        else:
            flash('Введите логин и пароль!')

    return render_template('auth.html')  # Финальный возврат для обработки всех остальных случаев